<!DOCTYPE html><html><head><title>Food HS Classifier</title><meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1'/><script src='https://unpkg.com/react@18/umd/react.development.js'></script><script src='https://unpkg.com/react-dom@18/umd/react-dom.development.js'></script><script src='https://unpkg.com/@babel/standalone/babel.min.js'></script><script src='https://cdn.tailwindcss.com'></script></head><body><div id='root'></div><script type='text/babel'>
const { useState, useEffect, useCallback } = React;

// Utils
const normalize = s => String(s||'').toLowerCase().replace(/[^\w\s]/g,' ').replace(/\s+/g,' ').trim();
const parseCsv = (text)=>{const lines=text.split(/\r?\n/).filter(l=>l.trim());if(!lines.length) return [];const headers=lines[0].split(',').map(h=>h.toLowerCase().trim().replace(/^"|"$/g,''));return lines.slice(1).map(line=>{const out=[];let cur='';let q=false;for(let i=0;i<line.length;i++){const c=line[i];if(c==='"'){if(q && line[i+1]==='"'){cur+='"';i++;}else{q=!q;}}else if(c===',' && !q){out.push(cur.trim());cur='';}else{cur+=c;}}out.push(cur.trim());const obj={};headers.forEach((h,i)=>obj[h]=out[i]||'');return obj;}).filter(r=>Object.values(r).some(v=>String(v).trim()));};
const levenshtein=(a,b)=>{const r=b.length+1,c=a.length+1,m=Array.from({length:r},(_,i)=>Array(c).fill(0));for(let i=0;i<r;i++)m[i][0]=i;for(let j=0;j<c;j++)m[0][j]=j;for(let i=1;i<r;i++){for(let j=1;j<c;j++){if(b[i-1]===a[j-1])m[i][j]=m[i-1][j-1];else m[i][j]=Math.min(m[i-1][j-1]+1,m[i][j-1]+1,m[i-1][j]+1);}}return m[r-1][c-1]};
const extractKeywords = text => normalize(text).split(' ').filter(w=>w.length>2 && !new Set(['the','and','or','but','in','on','at','to','for','of','with','by','a','an']).has(w));
const categoryLibraries={
  fish:['fish','salmon','tuna','cod','mackerel','sardine','herring','trout','bass','tilapia','catfish','halibut','snapper','grouper','swordfish','anchovy','carp','perch','pike','seafood','fillet','haddock','pollock','mahi','sole','flounder','mullet'],
  shellfish:['shrimp','prawn','lobster','crab','crayfish','oyster','mussel','clam','scallop','squid','octopus','shellfish','crustacean','mollusc'],
  meat:['meat','beef','pork','chicken','lamb','mutton','veal','poultry','turkey','duck','goose','venison','bacon','ham','sausage','steak','mince','chop','cutlet','breast','thigh','wing'],
  dairy:['milk','cheese','butter','cream','yogurt','dairy','cheddar','mozzarella','parmesan','whey','casein','lactose','buttermilk','ghee','paneer','gouda','brie','feta','ricotta','cottage cheese','sour cream'],
  fruits:['apple','banana','orange','grape','strawberry','mango','pineapple','watermelon','melon','berry','cherry','peach','pear','plum','fruit','lemon','lime','grapefruit','kiwi','papaya','guava','passion fruit','blueberry','raspberry','blackberry','cranberry','apricot','fig','date'],
  vegetables:['tomato','potato','onion','carrot','lettuce','cabbage','broccoli','cauliflower','spinach','pepper','cucumber','vegetable','garlic','celery','zucchini','eggplant','pumpkin','squash','asparagus','beet','radish','turnip','kale','chard','leek','shallot'],
  grains:['wheat','rice','corn','barley','oats','rye','grain','cereal','flour','meal','quinoa','millet','sorghum','bulgur','couscous','semolina','bran','germ','maize'],
  nuts:['almond','walnut','cashew','peanut','pecan','pistachio','hazelnut','macadamia','brazil nut','pine nut','chestnut','nut'],
  oils:['oil','olive oil','vegetable oil','coconut oil','palm oil','sunflower oil','canola oil','sesame oil','soybean oil','corn oil','peanut oil'],
  spices:['pepper','salt','cinnamon','turmeric','cumin','coriander','cardamom','clove','nutmeg','ginger','garlic powder','paprika','chili','cayenne','oregano','basil','thyme','rosemary','sage','spice','seasoning'],
  beverages:['wine','beer','spirits','juice','coffee','tea','soda','beverage','drink','water','whiskey','vodka','rum','gin','brandy']
};
const checkCategoryMatch=(keywords)=>{const set=new Set();for(const [cat,terms] of Object.entries(categoryLibraries)){for(const kw of keywords){const k=kw.toLowerCase();if(terms.some(t=>{const tt=t.toLowerCase();const d=levenshtein(k,tt);const max=Math.max(k.length,tt.length)||1;return k.includes(tt)||tt.includes(k)||(d/max<=0.3)||d<=2;})){set.add(cat);break;}}}return Array.from(set)};
const calcKeywordScore=(invKw, tarKw, invCats)=>{if(!invKw.length||!tarKw.length) return 0;let exact=0, partial=0;const tarCats=checkCategoryMatch(tarKw);const overlap=invCats.filter(c=>tarCats.includes(c)).length;const bonus=overlap*0.3;for(const iw of invKw){let best=0;for(const tw of tarKw){if(iw===tw) best=Math.max(best,1); else if(iw.includes(tw)||tw.includes(iw)) best=Math.max(best,0.5); else {const d=levenshtein(iw,tw);const max=Math.max(iw.length,tw.length);if(max>0 && d/max<=0.3) best=Math.max(best,0.7);} } if(best>=1) exact++; else if(best>0) partial+=best;}const base=(exact+partial)/Math.max(invKw.length, tarKw.length);return Math.min(1, base+bonus)};
const calcStringScore=(a,b)=>{const A=normalize(a),B=normalize(b);if(!A||!B) return 0; if(A===B) return 1; const d=levenshtein(A,B);const max=Math.max(A.length,B.length);return 1-(d/max)};

const App = () => {
  const [tariff, setTariff] = useState([]);
  const [inventory, setInventory] = useState([]);
  const [matches, setMatches] = useState([]);
  const [minScore, setMinScore] = useState(0.6);
  const [processing, setProcessing] = useState(false);

  const onInventoryFile = (e)=>{const f=e.target.files?.[0]; if(!f) return; const reader=new FileReader(); reader.onload=(ev)=>{const txt=String(ev.target.result||''); setInventory(parseCsv(txt));}; reader.readAsText(f);};
  const onTariffFile = (e)=>{const f=e.target.files?.[0]; if(!f) return; const reader=new FileReader(); reader.onload=(ev)=>{const txt=String(ev.target.result||''); const rows=parseCsv(txt); const mapped=rows.map(r=>({ description: r.description||r.product||r.commodity||r.item||r.goods||r.desc||r['description']||r['Description']||r['DESC']||'', hsCode: r['hs code']||r.hs_code||r.hscode||r.code||r['HS Code']||r['HSCODE']||r['Code']||''})).filter(x=>x.description); setTariff(mapped);}; reader.readAsText(f);};

  const findBestMatch = useCallback((item)=>{
    const name = item.name || item.product_name || item.item_name || '';
    const invKw = extractKeywords(name);
    const invCats = checkCategoryMatch(invKw);
    let best=null, bestScore=0;
    for(const t of tariff){
      const desc = t.description || t.Description || '';
      if(!desc) continue;
      const tarKw = extractKeywords(desc);
      const kScore = calcKeywordScore(invKw, tarKw, invCats);
      const sScore = calcStringScore(name, desc);
      const score = kScore*0.7 + sScore*0.3;
      if(score>bestScore && score>=minScore){ bestScore=score; best={ description: desc, hsCode: t.hsCode || t['HS Code'] || t['hs code'] || '', score }; }
    }
    return best;
  },[tariff,minScore]);

  const onStart = ()=>{
    if(!tariff.length || !inventory.length) return;
    setProcessing(true);
    setTimeout(()=>{
      const res = inventory.map(it=>{const m=findBestMatch(it); return { inventory: it, match: m, status: m?'matched':'unmatched' }; });
      setMatches(res); setProcessing(false);
    }, 50);
  };

  const exportCsv = ()=>{
    const header=['Inventory Name','Matched Description','HS Code','Score','Status'];
    const rows=matches.map(m=>[m.inventory.name||m.inventory.product_name||m.inventory.item_name||'', m.match?.description||'No match found', m.match?.hsCode||'', m.match?`${(m.match.score*100).toFixed(1)}%`:'0%', m.status]);
    const csv=[header,...rows].map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='matching_results.csv'; a.click(); URL.revokeObjectURL(url);
  };

  const ready = tariff.length>0 && inventory.length>0;

  return (
    <div className='min-h-screen bg-gray-50 p-6'>
      <div className='max-w-6xl mx-auto'>
        <div className='bg-white rounded-lg shadow-lg p-6 mb-6'>
          <h1 className='text-3xl font-bold text-gray-800 mb-2'>Inventory to Tariff Fuzzy Matching</h1>
          <p className='text-gray-600'>Upload both files: Tariff CSV and Inventory CSV.</p>
          <div className='grid md:grid-cols-2 gap-6 mt-4'>
            <div className='border-2 border-dashed border-gray-300 rounded-lg p-6 text-center'>
              <div className='text-sm text-gray-700 mb-2'>Tariff CSV</div>
              <input type='file' accept='.csv' onChange={onTariffFile} />
              {tariff.length>0 && <div className='text-green-600 font-medium mt-2'>✓ {tariff.length} rows loaded</div>}
            </div>
            <div className='border-2 border-dashed border-gray-300 rounded-lg p-6 text-center'>
              <div className='text-sm text-gray-700 mb-2'>Inventory CSV</div>
              <input type='file' accept='.csv' onChange={onInventoryFile} />
              {inventory.length>0 && <div className='text-green-600 font-medium mt-2'>✓ {inventory.length} items loaded</div>}
            </div>
          </div>

          <div className='flex items-center gap-4 mt-6'>
            <div className='flex items-center gap-2'>
              <label className='text-sm font-medium'>Minimum Score:</label>
              <input type='range' min='0.1' max='1' step='0.1' value={minScore} onChange={e=>setMinScore(parseFloat(e.target.value))} className='w-32' />
              <span className='text-sm text-gray-600'>{(minScore*100).toFixed(0)}%</span>
            </div>
            <button onClick={onStart} disabled={!ready||processing} className={`px-6 py-2 rounded text-white ${ready&&!processing?'bg-blue-600 hover:bg-blue-700':'bg-gray-400 cursor-not-allowed'}`}>{processing?'Processing...':'Start Matching'}</button>
            {matches.length>0 && (<button onClick={exportCsv} className='px-6 py-2 rounded text-white bg-indigo-600 hover:bg-indigo-700'>Export Results</button>)}
          </div>
        </div>

        {matches.length>0 && (
          <div className='bg-white rounded-lg shadow-lg overflow-hidden'>
            <div className='px-6 py-4 border-b border-gray-200'><h2 className='text-xl font-semibold'>Matching Results</h2></div>
            <div className='overflow-x-auto max-h-96'>
              <table className='w-full'>
                <thead className='bg-gray-50 sticky top-0'>
                  <tr>
                    <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>Inventory Item</th>
                    <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>Matched Description</th>
                    <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>HS Code</th>
                    <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>Score</th>
                    <th className='px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'>Status</th>
                  </tr>
                </thead>
                <tbody className='bg-white divide-y divide-gray-200'>
                  {matches.map((m,i)=> (
                    <tr key={i} className={m.status==='matched'?'bg-green-50':'bg-red-50'}>
                      <td className='px-6 py-4 text-sm font-medium text-gray-900'>{m.inventory.name||m.inventory.product_name||m.inventory.item_name||''}</td>
                      <td className='px-6 py-4 text-sm text-gray-900'>{m.match?.description||'No match found'}</td>
                      <td className='px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono'>{m.match?.hsCode||'-'}</td>
                      <td className='px-6 py-4 whitespace-nowrap text-sm text-gray-900'>
                        {m.match? <div className='flex items-center gap-2'>
                          <div className='w-16 bg-gray-200 rounded-full h-2'><div className='bg-blue-500 h-2 rounded-full' style={{width:`${(m.match.score*100).toFixed(0)}%`}}></div></div>
                          <span>{(m.match.score*100).toFixed(1)}%</span>
                        </div> : '0%'}
                      </td>
                      <td className='px-6 py-4 whitespace-nowrap'>{m.status==='matched'?<span className='text-green-600'>Matched</span>:<span className='text-red-600'>Unmatched</span>}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script></body></html>
